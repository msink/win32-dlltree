plugins {
    id "org.jetbrains.kotlin.multiplatform" version "1.3.11"
}

repositories {
    mavenCentral()
}

kotlin {
    targets {
        fromPreset(presets.mingwX64, 'windows') {
            compilations.main {
                outputKinds 'executable'
                entryPoint 'ntldd.main'
                cinterops {
                    imagehlp
                }
            }
        }
    }
}

task runProgram {
    def buildType = 'DEBUG' // 'RELEASE'
    def target = kotlin.targets.find {
        it instanceof org.jetbrains.kotlin.gradle.plugin.mpp.KotlinNativeTarget && it.publishable
    }

    dependsOn target.compilations.main.linkTaskName('EXECUTABLE', buildType)

    doLast {
        exec {
            executable target.compilations.main.getBinary('EXECUTABLE', buildType)
        }
    }
}
